import os
import zipfile
import shutil

# Get the current working directory
root_folder = os.getcwd()

# Create the 'temp' folder if it doesn't exist
temp_folder = os.path.join(root_folder, 'temp')
os.makedirs(temp_folder, exist_ok=True)

# Search for .zip files in the root folder
zip_files = [file for file in os.listdir(root_folder) if file.endswith('.zip')]

# Extract .csv files from each .zip file and rename them
for zip_file in zip_files:
    zip_path = os.path.join(root_folder, zip_file)
    with zipfile.ZipFile(zip_path, 'r') as zip_ref:
        zip_ref.extractall(temp_folder)

    csv_files = [file for file in os.listdir(temp_folder) if file.endswith('.csv')]
    for index, csv_file in enumerate(csv_files):
        csv_path = os.path.join(temp_folder, csv_file)
        new_csv_name = f"{index + 1}_{csv_file}"
        new_csv_path = os.path.join(temp_folder, new_csv_name)
        os.rename(csv_path, new_csv_path)

# Read and modify the content of .csv files
csv_files = [file for file in os.listdir(temp_folder) if file.endswith('.csv')]
output_file = os.path.join(temp_folder, 'report_final.csv')

with open(output_file, 'w') as outfile:
    for index, csv_file in enumerate(csv_files):
        csv_path = os.path.join(temp_folder, csv_file)
        with open(csv_path, 'r') as infile:
            lines = infile.readlines()
            if index != 0:
                lines = lines[1:]  # Remove the first line (except for the first file)
            outfile.writelines(lines)

print("Extraction and processing complete.")

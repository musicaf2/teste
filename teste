import os
import shutil
import zipfile
import glob

# Create a 'temp' folder if it doesn't exist
temp_folder = 'temp'
if not os.path.exists(temp_folder):
    os.makedirs(temp_folder)

# Find .zip files in the root folder
root_folder = os.getcwd()  # Assumes the script is in the root folder
zip_files = glob.glob('*.zip')

# Extract .zip files to the 'temp' folder
for zip_file in zip_files:
    with zipfile.ZipFile(zip_file, 'r') as zip_ref:
        zip_ref.extractall(temp_folder)

# Remove all non-.csv files and rename them in order
csv_files = glob.glob(os.path.join(temp_folder, '*.csv'))
csv_files.sort()  # Sort the files in ascending order

for i, csv_file in enumerate(csv_files, start=1):
    new_name = str(i) + '.csv'
    os.rename(csv_file, os.path.join(temp_folder, new_name))

# Remove the first line from all but the first file
for i, csv_file in enumerate(csv_files[1:], start=2):
    with open(csv_file, 'r') as file:
        lines = file.readlines()
    with open(csv_file, 'w') as file:
        file.writelines(lines[1:])

# Copy all .csv files to 'report_final'
report_final = 'report_final.csv'
with open(report_final, 'w') as outfile:
    for csv_file in csv_files:
        with open(csv_file, 'r') as infile:
            outfile.write(infile.read())

# Cleanup: Remove the 'temp' folder and its contents
shutil.rmtree(temp_folder)

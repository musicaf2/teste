import os
import zipfile
import csv

def extract_zip_files(root_folder):
    zip_files = []
    for dirpath, dirnames, filenames in os.walk(root_folder):
        for filename in filenames:
            if filename.endswith('.zip'):
                zip_files.append(os.path.join(dirpath, filename))
    
    for zip_file in zip_files:
        with zipfile.ZipFile(zip_file, 'r') as zip_ref:
            zip_ref.extractall('temp')

def rename_csv_files(root_folder):
    csv_files = []
    for dirpath, dirnames, filenames in os.walk(root_folder):
        for filename in filenames:
            if filename.endswith('.csv'):
                csv_files.append(os.path.join(dirpath, filename))
    
    csv_files.sort()  # Sort files in ascending order
    
    for i, csv_file in enumerate(csv_files):
        if i > 0:
            new_filename = str(i) + '.csv'
            new_filepath = os.path.join(os.path.dirname(csv_file), new_filename)
            os.rename(csv_file, new_filepath)
    
    for csv_file in csv_files[1:]:
        with open(csv_file, 'r') as file:
            lines = file.readlines()
        
        with open(csv_file, 'w', newline='') as file:
            writer = csv.writer(file)
            writer.writerows([line.strip().split(',') for line in lines[1:]])

def join_csv_files(root_folder, output_file):
    csv_files = []
    for dirpath, dirnames, filenames in os.walk(root_folder):
        for filename in filenames:
            if filename.endswith('.csv'):
                csv_files.append(os.path.join(dirpath, filename))
    
    csv_files.sort()  # Sort files in ascending order
    
    with open(output_file, 'w', newline='') as outfile:
        writer = csv.writer(outfile)
        for csv_file in csv_files:
            with open(csv_file, 'r') as infile:
                lines = infile.readlines()
                writer.writerows([line.strip().split(',') for line in lines])

# Example usage:
root_folder = '.'  # Root folder where the executable .py file is located
extract_zip_files(root_folder)
rename_csv_files(root_folder)
join_csv_files('temp', 'report_final.csv')

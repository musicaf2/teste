import os
import zipfile
import csv

# Find all .zip files in the root folder
root_folder = os.path.dirname(os.path.abspath(__file__))
zip_files = [file for file in os.listdir(root_folder) if file.endswith('.zip')]

# Create a 'temp' folder if it doesn't exist
temp_folder = os.path.join(root_folder, 'temp')
os.makedirs(temp_folder, exist_ok=True)

# Extract .zip files to the 'temp' folder
for zip_file in zip_files:
    zip_path = os.path.join(root_folder, zip_file)
    with zipfile.ZipFile(zip_path, 'r') as zip_ref:
        zip_ref.extractall(temp_folder)

# Find all .csv files in the 'temp' folder
csv_files = [file for file in os.listdir(temp_folder) if file.endswith('.csv')]

# Sort the .csv files by name
csv_files.sort()

# Remove the first line of all .csv files except the first one
for i, csv_file in enumerate(csv_files):
    csv_path = os.path.join(temp_folder, csv_file)
    with open(csv_path, 'r') as file:
        lines = file.readlines()
    with open(csv_path, 'w', newline='') as file:
        writer = csv.writer(file)
        if i > 0:
            writer.writerows(lines[1:])
        else:
            writer.writerows(lines)

# Join all .csv files into a new file 'report_final.csv'
report_path = os.path.join(root_folder, 'report_final.csv')
with open(report_path, 'w', newline='') as report_file:
    writer = csv.writer(report_file)
    for csv_file in csv_files:
        csv_path = os.path.join(temp_folder, csv_file)
        with open(csv_path, 'r') as csv_file:
            reader = csv.reader(csv_file)
            writer.writerows(reader)

print("Task completed successfully!")

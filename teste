import os
import zipfile
import csv

def extract_zip_files(root_folder):
    temp_folder = os.path.join(root_folder, 'temp')
    os.makedirs(temp_folder, exist_ok=True)

    zip_files = [file for file in os.listdir(root_folder) if file.endswith('.zip')]
    for zip_file in zip_files:
        zip_path = os.path.join(root_folder, zip_file)
        with zipfile.ZipFile(zip_path, 'r') as zip_ref:
            zip_ref.extractall(temp_folder)

def rename_csv_files(root_folder):
    csv_files = [file for file in os.listdir(root_folder) if file.endswith('.csv')]
    csv_files.sort()  # Sort the files in ascending order

    for index, csv_file in enumerate(csv_files, start=1):
        csv_path = os.path.join(root_folder, csv_file)
        new_csv_path = os.path.join(root_folder, f'{index}.csv')
        os.rename(csv_path, new_csv_path)

        if index != 1:  # Skip the first file
            remove_first_line(new_csv_path)

def remove_first_line(csv_file):
    with open(csv_file, 'r') as file:
        lines = file.readlines()

    with open(csv_file, 'w') as file:
        file.writelines(lines[1:])

def join_csv_files(root_folder, output_file):
    csv_files = [file for file in os.listdir(root_folder) if file.endswith('.csv')]
    csv_files.sort()  # Sort the files in ascending order

    with open(output_file, 'w') as output:
        for csv_file in csv_files:
            csv_path = os.path.join(root_folder, csv_file)
            with open(csv_path, 'r') as file:
                output.write(file.read())

root_folder = '.'  # Change this to the root folder where your .py files are located

# Extract .zip files into 'temp' folder
extract_zip_files(root_folder)

# Rename .csv files and remove the first line (except for the first file)
rename_csv_files(root_folder)

# Join all .csv files into 'report_final.csv'
join_csv_files(root_folder, 'report_final.csv')

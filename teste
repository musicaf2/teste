import os
import zipfile
import csv

# Step 1: Search for .zip files inside the root folder
root_folder = os.getcwd()  # Assuming the root folder is the current working directory
zip_files = [file for file in os.listdir(root_folder) if file.endswith('.zip')]

# Step 2: Extract the .zip files into a 'temp' folder
temp_folder = os.path.join(root_folder, 'temp')
os.makedirs(temp_folder, exist_ok=True)

for zip_file in zip_files:
    with zipfile.ZipFile(zip_file, 'r') as zf:
        zf.extractall(temp_folder)

# Step 3: Search for .csv files in the 'temp' folder
csv_files = [file for file in os.listdir(temp_folder) if file.endswith('.csv')]

# Step 4: Rename the .csv files and remove the first line, except the first file
for i, csv_file in enumerate(csv_files):
    old_path = os.path.join(temp_folder, csv_file)
    new_name = f"{i + 1}.csv"
    new_path = os.path.join(temp_folder, new_name)
    
    # Rename the file
    os.rename(old_path, new_path)
    
    # Remove the first line, except for the first file
    if i != 0:
        with open(new_path, 'r') as file:
            lines = file.readlines()
        with open(new_path, 'w') as file:
            file.writelines(lines[1:])

# Step 5: Sum all the .csv files into a new file called 'report_final.csv'
output_file = os.path.join(root_folder, 'report_final.csv')

with open(output_file, 'w') as output:
    for i, csv_file in enumerate(csv_files):
        file_path = os.path.join(temp_folder, csv_file)
        
        with open(file_path, 'r') as file:
            lines = file.readlines()
        
        # If it's not the first file, skip the header line
        if i != 0:
            lines = lines[1:]
        
        output.writelines(lines)

# Cleanup: Remove the 'temp' folder
for file in os.listdir(temp_folder):
    file_path = os.path.join(temp_folder, file)
    if os.path.isfile(file_path):
        os.remove(file_path)
os.rmdir(temp_folder)

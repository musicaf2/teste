import os
import zipfile
import shutil
import csv

# Get the root folder where the script is located
root_folder = os.path.dirname(os.path.abspath(__file__))

# Create the 'temp' folder if it doesn't exist
temp_folder = os.path.join(root_folder, 'temp')
if not os.path.exists(temp_folder):
    os.makedirs(temp_folder)

# Search for .zip files in the root folder
zip_files = [file for file in os.listdir(root_folder) if file.endswith('.zip')]

# Extract the .zip files into the 'temp' folder
for zip_file in zip_files:
    zip_path = os.path.join(root_folder, zip_file)
    with zipfile.ZipFile(zip_path, 'r') as zip_ref:
        zip_ref.extractall(temp_folder)

# Search for .csv files in the extracted folders
csv_files = []
for foldername, _, filenames in os.walk(temp_folder):
    for filename in filenames:
        if filename.endswith('.csv'):
            csv_files.append(os.path.join(foldername, filename))

# Move the .csv files to the root of the 'temp' folder
for csv_file in csv_files:
    shutil.move(csv_file, temp_folder)

# Remove the first line of each .csv file, except the first one
combined_csv_path = os.path.join(temp_folder, 'combined.csv')
first_file = True

with open(combined_csv_path, 'w', newline='') as combined_csv:
    writer = csv.writer(combined_csv)
    
    for csv_file in csv_files:
        with open(csv_file, 'r') as file:
            reader = csv.reader(file)
            lines = list(reader)
            
            if first_file:
                writer.writerows(lines)
                first_file = False
            else:
                writer.writerows(lines[1:])

print('CSV files combined successfully.')
